<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Settings</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../css/user.css">
  <link rel="stylesheet" href="../../css/account.css">
  <link rel="stylesheet" href="../css/submit-report.css">
  <link rel="icon" type="image/png" href="/src/IMG/US.png">
</head>

<body>
  <div class="profile-settings-wrapper">
    <div class="profile-left">
      <div class="profile-header">
        <i class="fa-solid fa-arrow-left" onclick="goBackToIndex()" style="cursor: pointer;"></i>
        <span>PROFILE SETTINGS</span>
        <button class="edit-profile-btn" type="button" aria-label="Edit Profile">
          Edit Profile <i class="fa-regular fa-pen-to-square"></i>
        </button>
      </div>
      <div class="profile-avatar" id="profileImageContainer">
        <img id="profileImg" src="" alt="Profile Picture"
          style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: none;">
        <i id="placeholderIcon" class="fa-solid fa-user" style="font-size: 2rem; color: #666;"></i>
        <div id="editProfileIcon" class="edit-profile-icon" style="display: none;">
          <i class="fa-solid fa-camera"></i>
        </div>
      </div>
      <div class="profile-section-titles">General</div>
      <div class="profile-fields">
        <div class="profile-field">
          <div class="profile-label">Full Name
            <div class="profile-desc">Your display name</div>
          </div>
          <input class="profile-input" type="text" name="fullName">
        </div>
        <div class="profile-field">
          <div class="profile-label">Contact Number</div>
          <input class="profile-input" type="text" name="contactNumber">
        </div>
        <!-- Address removed per user request -->
      </div>
      <div class="profile-section-title">Security</div>
      <div class="profile-fields">
        <div class="profile-field">
          <div class="profile-label">Email Address</div>
          <input class="profile-input" type="text" name="email">
        </div>
        <div class="profile-field">
          <div class="profile-label">Password</div>
          <input class="profile-input" type="password" name="password" placeholder="••••••••">
        </div>
      </div>
      <!-- Save/Cancel buttons (hidden by default) -->
      <div class="profile-btn-row" id="saveCancelButtons" style="display: none;">
        <button class="btn-cancel" type="button" onclick="cancelEdit()">
          <i class="fa-solid fa-times"></i> Cancel
        </button>
        <button class="btn-save" type="button" onclick="saveProfileData()">
          <i class="fa-solid fa-check"></i> Save Changes
        </button>
      </div>

      <a id="logout-link" class="logout-link" href="#" role="button" aria-label="Log the user out"
        onclick="handleLogout(event)" style="cursor: pointer;">Log out</a>
    </div>
    <div class="profile-divider"></div>
    <div class="profile-right">
      <!-- Support Tickets Section -->
      <div class="support-section">
        <div class="support-header">
          <h2><i class="fas fa-headset"></i> Support</h2>
        </div>
        <div class="support-buttons">
          <button class="btn-submit-report" onclick="goToSubmitReport()">
            <i class="fas fa-plus-circle"></i> Submit Ticket
          </button>
          <button class="btn-view-tickets" onclick="toggleAllTickets()" id="viewTicketsBtn">
            <i class="fas fa-history"></i> View Past Tickets
          </button>
        </div>
        
        <!-- My Tickets Container -->
        <div id="tickets-container" class="tickets-container">
          <div id="tickets-loading" class="loading-message" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i> Loading your tickets...
          </div>

          <div id="no-tickets" class="no-tickets-message" style="display: none;">
            <i class="fas fa-ticket-alt"></i>
            <p>No support tickets</p>
            <small>Submit a ticket if you need assistance with an order</small>
          </div>

          <div id="tickets-list" class="tickets-list">
            <!-- Tickets will be populated here -->
          </div>
        </div>
      </div>

      <!-- Order History Section -->
      <div class="order-history-title">Order History</div>

      <!-- Order History Container -->
      <div id="order-history-container" class="order-history-container">
        <div id="order-loading" class="loading-message" style="display: none;">
          <i class="fas fa-spinner fa-spin"></i> Loading your orders...
        </div>

        <div id="no-orders" class="no-orders-message" style="display: none;">
          <i class="fas fa-receipt"></i>
          <p>No orders found</p>
          <small>Your order history will appear here once you place an order</small>
        </div>

        <div id="orders-list" class="orders-list">
          <!-- Orders will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Submit Report Modal -->
  <div id="submitReportModal" class="report-modal" style="display: none;">
    <div class="report-modal-overlay" onclick="closeReportModal()"></div>
    <div class="report-modal-content">
      <!-- Modal Header -->
      <div class="report-modal-header">
        <h2><i class="fas fa-headset"></i> Submit Support Ticket</h2>
        <button class="report-modal-close" onclick="closeReportModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="report-modal-body">
        <p class="modal-intro">Please provide details about your issue and we'll get back to you as soon as possible.</p>

        <form id="reportForm" class="report-form">
          <!-- Issue Category -->
          <div class="form-group">
            <label for="category">
              <i class="fas fa-tag"></i> Issue Category *
            </label>
            <select id="category" name="category" required>
              <option value="">Select a category</option>
              <option value="delivery-issue">Delivery Issue (Not Delivered/Late)</option>
              <option value="food-quality">Food Quality Problem</option>
              <option value="wrong-order">Wrong Order Received</option>
              <option value="missing-items">Missing Items</option>
              <option value="other">Other</option>
            </select>
          </div>

          <!-- Reference Number -->
          <div class="form-group">
            <label for="subject">
              <i class="fas fa-hashtag"></i> Reference Number *
            </label>
            <input 
              type="text" 
              id="subject" 
              name="subject" 
              placeholder="Enter your payment reference number"
              pattern="[0-9]*"
              inputmode="numeric"
              maxlength="50"
              required
              oninput="this.value = this.value.replace(/[^0-9]/g, '')"
            >
            <small class="form-help">Enter numbers only</small>
          </div>

          <!-- Description -->
          <div class="form-group">
            <label for="description">
              <i class="fas fa-align-left"></i> Description *
            </label>
            <textarea 
              id="description" 
              name="description" 
              rows="5"
              placeholder="Please provide detailed information about your issue..."
              minlength="20"
              maxlength="1000"
              required
            ></textarea>
            <small class="form-help"><span id="descCount">0</span>/1000 characters (minimum 20)</small>
          </div>

          <!-- Photo Upload (Optional) -->
          <div class="form-group">
            <label for="photoUpload">
              <i class="fas fa-camera"></i> Attach Photo (Optional)
            </label>
            <div class="file-upload-wrapper">
              <input 
                type="file" 
                id="photoUpload" 
                name="photo" 
                accept="image/*"
                class="file-input"
              >
              <label for="photoUpload" class="file-label">
                <i class="fas fa-cloud-upload-alt"></i>
                <span id="fileName">Choose a photo</span>
              </label>
            </div>
            <div id="imagePreview" class="image-preview" style="display: none;">
              <img id="previewImg" src="" alt="Preview">
              <button type="button" class="remove-image" onclick="removeImage()">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <!-- Customer Info Preview -->
          <div class="customer-info-preview">
            <h3><i class="fas fa-user"></i> Your Contact Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Name:</span>
                <span id="customerName">Loading...</span>
              </div>
              <div class="info-item">
                <span class="info-label">Email:</span>
                <span id="customerEmail">Loading...</span>
              </div>
              <div class="info-item">
                <span class="info-label">Phone:</span>
                <span id="customerPhone">Loading...</span>
              </div>
            </div>
          </div>

          <!-- Loading Indicator -->
          <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Submitting your ticket...</span>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeReportModal()">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn-submit" id="submitBtn">
              <i class="fas fa-paper-plane"></i> Submit Ticket
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="success-modal" style="display: none;">
    <div class="success-modal-overlay" onclick="closeSuccessModal()"></div>
    <div class="success-modal-content">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Ticket Submitted Successfully!</h2>
      <p>Your ticket has been received and our team will review it shortly.</p>
      <div class="ticket-info">
        <strong>Ticket ID:</strong> <span id="ticketIdDisplay"></span>
      </div>
      <div class="success-actions">
        <button class="btn-primary" onclick="closeSuccessModal()">
          <i class="fas fa-check"></i> Got it
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <!-- Firebase Config -->
  <script src="../firebase-config.js"></script>

  <!-- Authentication Manager for Auto Logout -->
  <script src="../javascript/auth-manager.js"></script>

  <!-- Firebase Orders Management -->
  <script src="../javascript/firebase-orders.js"></script>

  <!-- Cloudinary Upload Script -->
  <script src="../../cloud.js"></script>

  <!-- Report History Script -->
  <script src="../javascript/report-history.js"></script>

  <!-- Report Submission Script -->
  <script src="../javascript/submit-report.js"></script>

  <script src="../javascript/profilesettings.js"></script>
</body>

</html>