<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Tickets - Admin Panel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="../css/nav.css">
    <link rel="stylesheet" href="../css/reports.css">
    <link rel="icon" href="../src/IMG/DB.png" type="image/png">
</head>
<body class="bg-light">
    <!-- Mobile overlay for sidebar -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <div class="dashboard-container d-flex" id="dashboardContainer">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="sidebar d-flex flex-column align-items-center py-3">
            <button id="closeSidebarBtn" class="btn btn-outline-light d-lg-none mb-3" style="align-self: flex-start; margin-left: 1rem;">
                <i class="bi bi-x-lg"></i>
            </button>
            <div class="brand mb-1">
                <img src="../src/Canva Scratch (3).png" class="rounded-circle" alt="Logo">
            </div>
            <nav class="nav flex-column w-100 text-center">
                <a href="../html/Dashboard.html" class="nav-link text-white" title="Home">
                    <img src="../src/Icons/home.png" alt="Home" class="nav-icon">
                    <div class="nav-text">Home</div>
                </a>

                <a href="../html/notifi.html" class="nav-link text-white" title="Notifications" style="position:relative;">
                    <img src="../src/Icons/bell.png" alt="Notifications" class="nav-icon">
                    <span class="notification-badge" style="display:none;position:absolute;top:6px;right:12px;background:#e53935;color:#fff;border-radius:50%;padding:2px 7px;font-size:0.85rem;font-weight:700;z-index:2;"></span>
                    <div class="nav-text">Notifications</div>
                </a>
                <a href="../html/Order.html" class="nav-link text-white" title="Orders">
                    <img src="../src/Icons/shopping-bag.png" alt="Sales" class="nav-icon">
                    <div class="nav-text">Orders</div>
                </a>
                <a href="../html/pos.html" class="nav-link text-white" title="POS">
                    <img src="../src/Icons/cashier-machine.png" alt="POS" class="nav-icon">
                    <div class="nav-text">POS</div>
                </a>
                <a href="../html/menu.html" class="nav-link text-white" title="Menu">
                    <img src="../src/Icons/menu (1).png" alt="Menu" class="nav-icon">
                    <div class="nav-text">Menu</div>
                </a>

                <a href="../html/Inventory.html" class="nav-link text-white" title="Inventory">
                    <img src="../src/Icons/inventory.png" alt="Inventory" class="nav-icon">
                    <div class="nav-text">Inventory</div>
                </a>
                <a href="../html/analytics.html" class="nav-link text-white" title="Reports">
                    <img src="../src/Icons/bars.png" alt="reports" class="nav-icon">
                    <div class="nav-text">Reports</div>
                </a>

                <a href="../html/user.html" class="nav-link text-white" title="Users">
                    <img src="../src/Icons/user.png" alt="user" class="nav-icon">
                    <div class="nav-text">Users</div>
                </a>
                <a href="../html/reports.html" class="nav-link text-white active" title="Support Tickets" style="position:relative;">
                    <img src="../src/Icons/support.png" alt="Support" class="nav-icon">
                    <span class="support-badge" style="display:none;position:absolute;top:8px;right:18px;background:#e53935;color:#fff;border-radius:50%;padding:2px 7px;font-size:0.85rem;font-weight:700;z-index:2;"></span>
                    <div class="nav-text">Support</div>
                </a>
                <div style="flex-grow: 1;"></div>

                <a href="../html/Settings.html" class="nav-link text-white" title="Settings">
                    <img src="../src/Icons/setting.png" alt="Settings" class="nav-icon">
                    <div class="nav-text">Settings</div>
                </a>
                <a href="#" class="nav-link text-white" title="Logout" onclick="event.preventDefault(); logoutUser();">
                    <img src="../src/Icons/log-out.png" alt="logout" class="nav-icon">
                    <div class="nav-text">Logout</div>
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content flex-grow-1 p-4">
            <!-- Header Section -->
            <div class="content-header">
                <div>
                    <h1 class="page-title"><i class="fas fa-headset"></i> Support Tickets</h1>
                    <p class="page-subtitle">Manage customer support requests and issues</p>
                </div>
                <button id="menuToggle" class="btn btn-primary d-lg-none">
                    <i class="bi bi-list"></i>
                </button>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon pending-bg">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="statPending">0</h3>
                        <p>Pending</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon progress-bg">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="statInProgress">0</h3>
                        <p>In Progress</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon resolved-bg">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="statResolved">0</h3>
                        <p>Resolved</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon total-bg">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="statTotal">0</h3>
                        <p>Total Tickets</p>
                    </div>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="filters-section">
                <div class="filters-row">
                    <div class="filter-group">
                        <label><i class="fas fa-filter"></i> Status:</label>
                        <select id="filterStatus" class="filter-select">
                            <option value="all">All</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-tag"></i> Category:</label>
                        <select id="filterCategory" class="filter-select">
                            <option value="all">All</option>
                            <option value="delivery-issue">Delivery Issue</option>
                            <option value="food-quality">Food Quality</option>
                            <option value="wrong-order">Wrong Order</option>
                            <option value="missing-items">Missing Items</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group flex-grow-1">
                        <label><i class="fas fa-search"></i> Search:</label>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search by ticket ID or customer name...">
                    </div>
                </div>
            </div>

            <!-- Tickets Table -->
            <div class="tickets-table-container">
                <div id="loadingIndicator" class="loading-state" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading tickets...</p>
                </div>

                <div id="noTicketsMessage" class="no-tickets-state" style="display: none;">
                    <i class="fas fa-inbox"></i>
                    <h3>No tickets found</h3>
                    <p>No support tickets match your current filters</p>
                </div>

                <table id="ticketsTable" class="tickets-table">
                    <thead>
                        <tr>
                            <th>Ticket ID</th>
                            <th>Customer</th>
                            <th>Category</th>
                            <th>Reference Number</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ticketsTableBody">
                        <!-- Tickets will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ticket Detail Modal -->
    <div id="ticketModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2><i class="fas fa-ticket-alt"></i> Ticket Details</h2>
                <button class="modal-close" onclick="closeTicketModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="ticketModalBody">
                <!-- Ticket details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Config and Auth -->
    <script src="../javascript/config.js"></script>
    <script src="../javascript/auth-manager.js"></script>
    <script src="../javascript/nav.js"></script>

    <!-- Reports Management Script -->
    <script src="../javascript/reports.js"></script>
    <script src="../javascript/support-badge.js"></script>
</body>
</html>
